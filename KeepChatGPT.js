let ele = '<head>';
let eleReplace = '<head><script type="text/javascript">
+
'(function() {\n    \'use strict\';\n\n    var qs = document.querySelector.bind(document);\n\n    var tl = function(s) {\n        var lang = `\n{\n    "index": {"暗色主题": "dm", "浅色主题": "lm", "显示调试": "sd", "取消审计": "cm", "关于": "ab"},\n    "local": {\n"ar": {"dm": "الوضع الداكن", "lm": "وضع فاتح", "sd": "إظهار التصحيح", "cm": "إلغاء التدقيق", "ab": "حول"},\n"bg": {"dm": "Тъмна тема", "lm": "Светла тема", "sd": "Показване на отстраняване на грешки", "cm": "Отказ от одит", "ab": "За"},\n"cs": {"dm": "Tmavý režim", "lm": "Světlý režim", "sd": "Zobrazit ladění", "cm": "Zrušení auditu", "ab": "O"},\n"da": {"dm": "Mørk tilstand", "lm": "Lys tilstand", "sd": "Vis fejlfinding", "cm": "Annuller revision", "ab": "Om"},\n"de": {"dm": "Dunkler Modus", "lm": "Heller Modus", "sd": "Fehlerbehebung anzeigen", "cm": "Prüfung abbrechen", "ab": "Über"},\n"el": {"dm": "Σκοτεινή θεματολογία", "lm": "Φωτεινή θεματολογία", "sd": "Εμφάνιση αποσφαλμάτωσης", "cm": "Ακύρωση ελέγχου", "ab": "Σχετικά με"},\n"en": {"dm": "Dark mode", "lm": "Light mode", "sd": "Show debugging", "cm": "Cancel audit", "ab": "About"},\n"eo": {"dm": "Malhela moduso", "lm": "Hela moduso", "sd": "Montri depuradon", "cm": "Nuligi kontroli", "ab": "Pri"},\n"es": {"dm": "Modo oscuro", "lm": "Modo claro", "sd": "Mostrar depuración", "cm": "Cancelar auditoría", "ab": "Acerca de"},\n"fi": {"dm": "Tumma tila", "lm": "Vaalea tila", "sd": "Näytä virheenkorjaus", "cm": "Peruuta tarkistus", "ab": "Tietoa"},\n"fr": {"dm": "Mode sombre", "lm": "Mode clair", "sd": "Afficher le débogage", "cm": "Annuler l\'audit", "ab": "À propos de"},\n"fr-CA": {"dm": "Mode nuit", "lm": "Mode jour", "sd": "Afficher le débogage", "cm": "Annuler la vérification", "ab": "À propos de"},\n"he": {"dm": "מצב כהה", "lm": "מצב בהיר", "sd": "הצגת התיקון", "cm": "ביטול ביקורת", "ab": "אודות"},\n"hu": {"dm": "Sötét mód", "lm": "Világos mód", "sd": "Hibakeresés mutatása", "cm": "Ellenőrzés megszüntetése", "ab": "Rólunk"},\n"id": {"dm": "Mode gelap", "lm": "Mode terang", "sd": "Tampilkan debugging", "cm": "Batalkan audit", "ab": "Tentang"},\n"it": {"dm": "Modalità scura", "lm": "Modalità chiara", "sd": "Mostra debug", "cm": "Annulla verifica", "ab": "Riguardo a"},\n"ja": {"dm": "ダークモード", "lm": "ライトモード", "sd": "デバッグを表示", "cm": "監査をキャンセル", "ab": "について"},\n"ka": {"dm": "ბნელი რეჟიმი", "lm": "ნათელი რეჟიმი", "sd": "გამოჩენა დებაგი", "cm": "ანულირება აუდიტი", "ab": "შესახებ"},\n"ko": {"dm": "다크 모드", "lm": "라이트 모드", "sd": "디버깅 표시", "cm": "감사 취소", "ab": "관하여"},\n"nb": {"dm": "Mørk modus", "lm": "Lys modus", "sd": "Vis feilsøking", "cm": "Avbryt revisjonen", "ab": "Om"},\n"nl": {"dm": "Donkere modus", "lm": "Lichte modus", "sd": "Foutopsporing weergeven", "cm": "Controle annuleren", "ab": "Over"},\n"pl": {"dm": "Tryb ciemny", "lm": "Tryb jasny", "sd": "Pokaż debugowanie", "cm": "Anuluj audyt", "ab": "O"},\n"pt-BR": {"dm": "Modo escuro", "lm": "Modo claro", "sd": "Mostrar depuração", "cm": "Cancelar auditoria", "ab": "Sobre"},\n"ro": {"dm": "Mod întunecat", "lm": "Mod luminos", "sd": "Afișare depanare", "cm": "Anulare audit", "ab": "Despre"},\n"ru": {"dm": "Темный режим", "lm": "Светлый режим", "sd": "Показать отладку", "cm": "Отменить аудит", "ab": "О"},\n"sk": {"dm": "Tmavý režim", "lm": "Svetlý režim", "sd": "Zobraziť ladenie", "cm": "Zrušiť audit", "ab": "O"},\n"sr": {"dm": "Тамни режим", "lm": "Светла тема", "sd": "Прикажи отклањање грешака", "cm": "Откажи ревизију", "ab": "О"},\n"sv": {"dm": "Mörkt läge", "lm": "Ljust läge", "sd": "Visa felsökning", "cm": "Avbryt revision", "ab": "Om"},\n"th": {"dm": "โหมดมืด", "lm": "โหมดสว่าง", "sd": "แสดงการแก้ไขข้อผิดพลาด", "cm": "ยกเลิกการตรวจสอบ", "ab": "เกี่ยวกับ"},\n"tr": {"dm": "Karanlık mod", "lm": "Aydınlık mod", "sd": "Hata ayıklama göster", "cm": "Denetimi İptal Et", "ab": "Hakkında"},\n"uk": {"dm": "Темний режим", "lm": "Світлий режим", "sd": "Показати налагодження", "cm": "Скасувати аудит", "ab": "Про"},\n"ug": {"dm": "تېما كۆرسىتىش", "lm": "ئاچقۇچ كۆرۈنۈش", "sd": "كۆرسەتكەن يۇقىرىلاش", "cm": "ئەمەلدىن قالدۇرۇش", "ab": "ئۇچۇرلىق"},\n"vi": {"dm": "Chế độ tối", "lm": "Chế độ sáng", "sd": "Hiển thị gỡ lỗi", "cm": "Hủy đánh giá", "ab": "Về"},\n"zh-CN": {"dm": "暗色主题", "lm": "浅色主题", "sd": "显示调试", "cm": "取消审计", "ab": "关于"},\n"zh-TW": {"dm": "暗黑模式", "lm": "淺色主題", "sd": "顯示調試", "cm": "取消稽核", "ab": "關於"}\n    }\n}\n`;\n        var i, r, nl;\n        try {\n            lang = JSON.parse(lang);\n            i = lang.index[s];\n            nl = navigator.language;\n            if (nl in lang.local) {\n                r = lang.local[nl][i];\n            } else {\n                r = lang.local[nl.slice(0, 2)][i];\n            }\n        } catch (e) {\n            r = s;\n        }\n        return r;\n    };\n\n    var sv = function(key, value = "") {\n        GM_setValue(key, value);\n    };\n\n    var gv = function(key, value = "") {\n        return GM_getValue(key, value);\n    };\n\n    var formatDate = function(d) {\n        return (new Date(d)).toLocaleString();\n    };\n\n    var setIfr = function(u = "") {\n        if (qs("#xcanwin")==null) {\n            var nIfr = document.createElement(\'iframe\');\n            nIfr.id = "xcanwin";\n            nIfr.style = `height: 0px; width: 100%;`;\n            if (u) {\n                nIfr.src = u;\n            }\n            nIfr.onload = function() {\n                var nIfrText = qs("#xcanwin").contentWindow.document.documentElement.innerText;\n                try {\n                    qs("#xcanwin").contentWindow.document.documentElement.style = `background: #FCF3CF; height: 360px; width: 1080px; overflow; auto;`;\n                    if (nIfrText.indexOf(`"expires":"`) > -1) {\n                        console.log(`KeepChatGPT: IFRAME: Expire date: ${formatDate(JSON.parse(nIfrText).expires)}`);\n                    } else if (nIfrText.match(/Please stand by|while we are checking your browser|Please turn JavaScript on|Please enable Cookies|reload the page/)) {\n                        console.log(`KeepChatGPT: IFRAME: BypassCF`);\n                    }\n                } catch (e) {\n                    console.log(`KeepChatGPT: IFRAME: ERROR: ${e},\\nERROR RESPONSE:\\n${nIfrText}`);\n                }\n            };\n            qs("main").lastElementChild.appendChild(nIfr);\n        } else{\n            if (u) {\n                qs("#xcanwin").src = u;\n            }\n        }\n    };\n\n    var keepChat = function() {\n        fetch(u).then((response) => {\n            response.text().then((data) => {\n                try {\n                    var contentType = response.headers.get(\'Content-Type\');\n                    if (contentType.indexOf("application/json") > -1 && response.status !== 403 && data.indexOf(`"expires":"`) > -1) {\n                        console.log(`KeepChatGPT: FETCH: Expire date: ${formatDate(JSON.parse(data).expires)}`);\n                        qs("#xcanwin").contentWindow.document.documentElement.innerHTML = data;\n                    } else {\n                        setIfr(u);\n                    }\n                } catch (e) {\n                    console.log(`KeepChatGPT: FETCH: ERROR: ${e},\\nERROR RESPONSE:\\n${data}`);\n                    setIfr(u);\n                }\n            })\n        });\n    }\n\n    var loadMenu = function() {\n        var ndivmenu = document.createElement(\'div\');\n        ndivmenu.setAttribute("class", "kmenu");\n        ndivmenu.innerHTML = `<ul><li id=nmenuid1>${gv("k_showDebug", false)?tl("显示调试")+"✓":tl("显示调试")+"✗"}</li><li id=nmenuid2>${gv("k_theme", "light")=="light"?tl("浅色主题")+"✓":tl("暗色主题")+"✓"}</li><li id=nmenuid3>${gv("k_closeModer", false)==false?tl("取消审计")+"✗":tl("取消审计")+"✓"}</li><a href=\'${GM_info.script.namespace}\'><li id=nmenuid4>${tl("关于")}</li></a></ul>`;\n        document.body.appendChild(ndivmenu);\n\n        qs(\'#nmenuid1\').onclick = function() {\n            if (gv("k_showDebug", false) == true) {\n                if (qs(\'#xcanwin\')) qs(\'#xcanwin\').style.height = \'0px\';\n                qs(\'#nmenuid1\').innerText = tl("显示调试")+"✗";\n                sv("k_showDebug", false);\n            } else {\n                if (qs(\'#xcanwin\')) qs(\'#xcanwin\').style.height = \'80px\';\n                qs(\'#nmenuid1\').innerText = tl("显示调试")+"✓";\n                sv("k_showDebug", true);\n            }\n        };\n        qs(\'#nmenuid2\').onclick = function() {\n            if (gv("k_theme", "light") == "light") {\n                qs(\'#kcg\').styleOrigin = qs(\'#kcg\').style;\n                qs(\'#kcg\').style.background = "#2C3E50";\n                qs(\'#kcg\').style.animation = "none";\n                qs(\'#kcg\').style.color = "#ffffff";\n                qs(\'#kcg\').style.marginRight = "inherit";\n                qs(\'#nmenuid2\').innerText = tl("暗色主题")+"✓";\n                sv("k_theme", "dark");\n            } else {\n                qs(\'#kcg\').style = qs(\'#kcg\').styleOrigin;\n                qs(\'#nmenuid2\').innerText = tl("浅色主题")+"✓";\n                sv("k_theme", "light");\n            }\n        };\n        qs(\'#nmenuid3\').onclick = function() {\n            if (gv("k_closeModer", false) == true) {\n                byeModer(false);\n                qs(\'#nmenuid3\').innerText = tl("取消审计")+"✗";\n                sv("k_closeModer", false);\n            } else {\n                byeModer(true);\n                qs(\'#nmenuid3\').innerText = tl("取消审计")+"✓";\n                sv("k_closeModer", true);\n            }\n        };\n    };\n\n    var loadKCG = function() {\n        var symbol_prt;\n        if (qs("#kcg")!==null) {\n            return;\n        }\n        if (qs("main").kcg!==undefined) {\n            if (qs(symbol1_class)) {\n                qs("main").kcg.innerHTML = qs("main").kcg._symbol1_innerHTML;\n                symbol_prt = qs(symbol1_class).parentElement;\n            } else if (qs(symbol2_class)) {\n                qs("main").kcg.innerHTML = qs("main").kcg._symbol2_innerHTML;\n                symbol_prt = qs(symbol2_class).parentElement;\n            }\n            symbol_prt.insertBefore(qs("main").kcg, symbol_prt.childNodes[0]);\n            return;\n        }\n\n        loadMenu();\n        setIfr(u);\n\n        var ndivkcg = document.createElement("div");\n        ndivkcg.id = "kcg";\n        ndivkcg.setAttribute("class", "flex py-3 px-3 items-center gap-3 rounded-md text-sm mb-1 flex-shrink-0 border border-white/20");\n\n        var ndivmenu = qs(".kmenu");\n        ndivkcg.onmouseover = ndivmenu.onmouseover = function() {\n            ndivmenu.style.display = \'block\';\n            ndivmenu.style.left = `${qs("#kcg").getBoundingClientRect().right + 20}px`;\n            ndivmenu.style.top = `${qs("#kcg").getBoundingClientRect().top}px`;\n        };\n        ndivkcg.onmouseleave = ndivmenu.onmouseleave = function() {\n            ndivmenu.style.display = \'none\';\n        };\n        ndivkcg.onclick = function() {\n            if (ndivmenu.style.display == \'none\') {\n                ndivmenu.style.display = \'block\';\n                ndivmenu.style.left = `${qs("#kcg").getBoundingClientRect().right + 20}px`;\n                ndivmenu.style.top = `${qs("#kcg").getBoundingClientRect().top}px`;\n            } else {\n                ndivmenu.style.display = \'none\';\n            }\n        };\n        var icon = GM_info.script.icon ? GM_info.script.icon : `${GM_info.script.namespace}raw/main/assets/logo.svg`;\n        ndivkcg._symbol1_innerHTML = `<img src=\'${icon}\' />Keep${ndivkcg.id.slice(1,2).toUpperCase()}hatGPT by x${ndivkcg.id.slice(1,2)}anwin`;\n        ndivkcg._symbol2_innerHTML = `Keep${ndivkcg.id.slice(1,2).toUpperCase()}hatGPT`;\n\n        if (qs(symbol1_class)) {\n            ndivkcg.innerHTML = ndivkcg._symbol1_innerHTML;\n            symbol_prt = qs(symbol1_class).parentElement;\n        } else if (qs(symbol2_class)) {\n            ndivkcg.innerHTML = ndivkcg._symbol2_innerHTML;\n            symbol_prt = qs(symbol2_class).parentElement;\n        }\n        qs("main").kcg = ndivkcg;\n        symbol_prt.insertBefore(qs("main").kcg, symbol_prt.childNodes[0]);\n\n        addStyle();\n        setUserOptions();\n    };\n\n    var addStyle = function() {\n        GM_addStyle(`\n#kcg {\n    color: #555;\n    background: linear-gradient(to top right, #F0B27A, #FDE184, #F0B27A);\n    animation: gradient 6s ease-in-out infinite;\n    position: relative;\n    overflow: hidden;\n    font-weight: bold;\n    user-select: none;\n}\n@keyframes gradient {\n    0%{background-color:#F0B27A;}\n    50%{background-color:#FDE184;}\n    100%{background-color:#F0B27A;}\n}\n\n#kcg::before {\n    content: \'\';\n    position: absolute;\n    top: -50%;\n    left: -50%;\n    width: 200%;\n    height: 200%;\n    background: linear-gradient(\n        to bottom right,\n        rgba(255, 255, 255, 0.3),\n        rgba(255, 255, 255, 0.15),\n        rgba(255, 255, 255, 0)\n    );\n    transform: rotate(-45deg);\n    animation: shine 2.8s linear infinite;\n}\n@keyframes shine {\n    from {\n        transform: translateX(-50%) translateY(-50%) rotate(-45deg);\n    }\n    to {\n        transform: translateX(150%) translateY(150%) rotate(-45deg);\n    }\n}\n\n.kmenu {\n    background-color: #202123;\n    color: #FFFFFF;\n    border: 1px solid #4D4D4F;\n    border-radius: 10px;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);\n    display: none;\n    min-width: 200px;\n    padding: 12px 0;\n    position: absolute;\n    z-index: 1000;\n}\n.kmenu::before {\n    content: "";\n    position: absolute;\n    top: 0px;\n    bottom: 0px;\n    left: -30px;\n    right: 0px;\n    pointer-events: auto;\n    z-index: -1;\n}\n.kmenu::after {\n    content: "";\n    position: absolute;\n    top: 15px;\n    left: -20px;\n    border-style: solid;\n    border-width: 10px 10px 10px 10px;\n    border-color: transparent #202123 transparent transparent;\n}\n.kmenu li {\n    display: block;\n    padding: 8px 24px;\n    text-align: left;\n    user-select: none;\n}\n.kmenu li:hover {\n    background-color: #273746;\n    cursor: pointer;\n}\n\n.rounded-sm {\n    user-select: none;\n}\n\nnav {\n    position: relative;\n}\n`);\n    };\n\n    var setUserOptions = function() {\n        if (gv("k_showDebug", false) == true) {\n            if (qs(\'#xcanwin\')) qs(\'#xcanwin\').style.height = \'80px\';\n        } else {\n            if (qs(\'#xcanwin\')) qs(\'#xcanwin\').style.height = \'0px\';\n        }\n\n        if (gv("k_theme", "light") == "light") {\n            qs(\'#kcg\').styleOrigin = qs(\'#kcg\').style;\n        } else {\n            qs(\'#kcg\').style.background = "#2C3E50";\n            qs(\'#kcg\').style.animation = "none";\n            qs(\'#kcg\').style.color = "#ffffff";\n            qs(\'#kcg\').style.marginRight = "inherit";\n        }\n\n        if (gv("k_closeModer", false) == true) {\n            byeModer(true);\n        } else {\n            byeModer(false);\n        }\n    };\n\n    var byeModer = function(action) {\n        if (typeof _fetch == \'undefined\') {\n            var _fetch = fetch;\n        }\n        if (action == true) {\n            unsafeWindow.fetch = new Proxy(fetch, {\n                apply: function (target, thisArg, argumentsList) {\n                    var n = {};\n                    n.json = function() {return {};};\n                    return argumentsList[0].includes(\'moderations\') ? Promise.resolve(n) : target.apply(thisArg, argumentsList);\n                }\n            });\n        } else {\n            unsafeWindow.fetch = _fetch;\n        }\n    };\n\n    var byeConversationNotFound = function(action) {\n        if (typeof _fetch == \'undefined\') {\n            var _fetch = fetch;\n        }\n        if (action == true) {\n            unsafeWindow.fetch = new Proxy(_fetch, {\n                apply: function (target, thisArg, argumentsList) {\n                    try {\n                        if (argumentsList[0].includes(\'conversation\')) {\n                            var post_body = JSON.parse(argumentsList[1].body);\n                            post_body.conversation_id = location.href.match(/\\/c\\/(.*)/)[1];\n                            argumentsList[1].body = JSON.stringify(post_body);\n                        }\n                    } catch (e) {}\n                    return target.apply(thisArg, argumentsList);\n                }\n            });\n        } else {\n            unsafeWindow.fetch = _fetch;\n        }\n    };\n\n    setInterval(function() {\n        if (qs(symbol1_class) || qs(symbol2_class)) {\n            loadKCG();\n        }\n    }, 300);\n\n    setInterval(function() {\n        if (qs(symbol1_class) || qs(symbol2_class)) {\n            keepChat();\n        }\n    }, 1000 * 30);\n\n    var u = `/api/${GM_info.script.namespace.slice(33, 34)}uth/s${GM_info.script.namespace.slice(28, 29)}ssion`;\n    var symbol1_class = \'nav>a.flex\';\n    var symbol2_class = \'button.justify-center\';\n    byeConversationNotFound(true);\n\n})();'
+
'</script>'
let body = $response.body
    .replace(ele, eleReplace)
$done({ body });